<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Order Details</title>
<link rel="stylesheet" href="/css/styles.css">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
	rel="stylesheet">
<!-- Icon fontanwesome -->
<link rel="stylesheet"
	href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
	integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
	crossorigin="anonymous">
<!-- Reset css & grid sytem -->
<link rel="stylesheet" href="/assets/css/library.css">
<link href="/assets/owlCarousel/assets/owl.carousel.min.css"
	rel="stylesheet">
<!-- Layout -->
<link rel="stylesheet" href="/assets/css/common.css">
<!-- index -->
<link href="/assets/css/home.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Owl caroucel Js-->
<script src="/assets/owlCarousel/owl.carousel.min.js"></script>
<style>
h1 {
	font-size: 32px;
	margin-bottom: 20px;
	text-align: center;
	color: #333;
}

/* Định dạng tiêu đề phụ */
h2, .Error{
	font-size: 24px;
	margin-bottom: 15px;
	color: #555;
	border-bottom: 2px solid #ddd;
	padding-bottom: 5px;
}

.Error{
color: red;
text-align: center;}

/* Định dạng bảng hiển thị thông tin sản phẩm */
table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
	background-color: #fff;
}

table th, table td {
	padding: 15px;
	text-align: center;
	border: 1px solid #ddd;
	font-size: 16px;
}

table th {
	background-color: #e0e0e0;
	color: #333;
	font-weight: 600;
}

table tr:nth-child(even) {
	background-color: #f2f2f2;
}

table tr:hover {
	background-color: #e8f0fe;
}

/* Định dạng ảnh sản phẩm */
table img {
	width: 80px;
	height: 80px;
	object-fit: cover;
	border-radius: 5px;
	box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
}

/* Định dạng phần thông tin đơn hàng và khách hàng */
.order-info, .customer-info {
	margin-bottom: 30px;
}

.order-info p, .customer-info p {
	font-size: 16px;
	line-height: 1.6;
	color: #444;
}

.order-info p strong, .customer-info p strong {
	color: #000;
	font-weight: 600;
}

p {
	font-size: 20px;
	line-height: 1.6;
	color: #444;
}
/* Định dạng cho phần đánh giá */
.rating {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    width: 500px;
}


.rating label {
    font-size: 35px;
    color: #ccc;
    cursor: pointer;
    transition: color 0.3s;
    padding: 0 5px;
}

.rating {
display: flex;
    justify-content: space-around;
    margin-bottom: 20px;

}

/* Định dạng chung cho form */
.review-form {
    max-width: 600px;
    margin: 0 auto;
    padding: 25px;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
    background-color: #f8f8f8;
}

.review-form h2 {
    font-size: 28px;
    color: #333;
    text-align: center;
    margin-bottom: 25px;
    border-bottom: 2px solid #ddd;
    padding-bottom: 10px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 18px;
    color: #555;
    margin-bottom: 10px;
    font-weight: bold;
}

.form-group textarea {
    width: 100%;
    height: 120px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    resize: vertical;
    font-size: 16px;
    box-shadow: inset 0px 0px 5px rgba(0, 0, 0, 0.1);
}

.form-group input[type="file"] {
    display: block;
    font-size: 16px;
    margin-top: 10px;
}

.submit-btn {
    display: block;
    width: 100%;
    padding: 12px 0;
    background-color: #28a745;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-size: 18px;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s;
    margin-top: 15px;
}

.submit-btn:hover {
    background-color: #218838;
}

/* Định dạng chung cho input khi có lỗi */
.form-group input[type="file"]:focus,
.form-group textarea:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
}

/* Định dạng chung cho combobox */
select {
    width: 100%; /* Chiều rộng chiếm toàn bộ vùng chứa */
    padding: 12px; /* Khoảng cách bên trong */
    border: 1px solid #ccc; /* Đường viền */
    border-radius: 5px; /* Bo góc */
    background-color: #f9f9f9; /* Màu nền */
    font-size: 16px; /* Cỡ chữ */
    color: #333; /* Màu chữ */
    appearance: none; /* Ẩn mũi tên mặc định (trình duyệt hiện đại) */
    -webkit-appearance: none; /* Ẩn mũi tên mặc định trên WebKit */
    -moz-appearance: none; /* Ẩn mũi tên mặc định trên Firefox */
    cursor: pointer; /* Đổi con trỏ chuột khi di chuyển vào */
}

/* Thêm mũi tên tùy chỉnh cho combobox */
select:focus {
    outline: none; /* Bỏ đường viền mặc định khi được chọn */
    border-color: #66afe9; /* Đổi màu đường viền khi chọn */
    box-shadow: 0 0 5px rgba(102, 175, 233, 0.6); /* Hiệu ứng bóng đổ khi focus */
}

/* Thêm biểu tượng mũi tên cho combobox */
select::-ms-expand {
    display: none; /* Ẩn mũi tên mặc định trên IE */
}

.select-wrapper {
    position: relative; /* Định vị tương đối để thêm mũi tên tùy chỉnh */
    display: inline-block;
    width: 100%; /* Chiều rộng vùng chứa combobox */
}

.select-wrapper::after {
    content: '\25BC'; /* Ký tự Unicode cho mũi tên xuống */
    font-size: 16px; /* Cỡ mũi tên */
    color: #333; /* Màu của mũi tên */
    position: absolute; /* Định vị tuyệt đối */
    top: 50%; /* Canh giữa theo chiều dọc */
    right: 10px; /* Khoảng cách bên phải */
    pointer-events: none; /* Vô hiệu hóa sự kiện chuột trên mũi tên */
    transform: translateY(-50%); /* Canh giữa theo chiều dọc */
}


</style>
</head>
<body>
	<header th:replace="~{customer/fragments/header::header}"></header>
	<!-- Slider -->
	<div class="main__slice">
		<div class="slider">
			<div class="slide active"
				style="background-image: url(/assets/img/slider/slide-6.jpg)">
				<div class="container">
					<div class="caption">
						<h1>Giảm giá 30%</h1>
						<p>Giảm giá cực sốc trong tháng 6!</p>
						<a href="listProduct.html" class="btn btn--default">Xem ngay</a>
					</div>
				</div>
			</div>
			<div class="slide active"
				style="background-image: url(/assets/img/slider/slide-4.jpg)">
				<div class="container">
					<div class="caption">
						<h1>Giảm giá 30%</h1>
						<p>Giảm giá cực sốc trong tháng 6!</p>
						<a href="listProduct.html" class="btn btn--default">Xem ngay</a>
					</div>
				</div>
			</div>
			<div class="slide active"
				style="background-image: url(/assets/img/slider/slide-5.jpg)">
				<div class="container">
					<div class="caption">
						<h1>Giảm giá 30%</h1>
						<p>Giảm giá cực sốc trong tháng 6!</p>
						<a href="listProduct.html" class="btn btn--default">Xem ngay</a>
					</div>
				</div>
			</div>
		</div>
		<!-- controls  -->
		<div class="controls">
			<div class="prev">
				<i class="fas fa-chevron-left"></i>
			</div>
			<div class="next">
				<i class="fas fa-chevron-right"></i>
			</div>
		</div>
		<!-- indicators -->
		<div class="indicator"></div>
	</div>
	<!--Product Category -->
	<div class="containt">


		<h1>Chi tiết đơn hàng</h1>

		<!-- Thông tin chi tiết của đơn hàng -->
		<div>
			<h2>Order Information</h2>
			<p>
				<strong>Order ID:</strong> <span th:text="${order.orderId}"></span>
			</p>
			<p>
				<strong>Order Date:</strong> <span th:text="${order.orderDate}"></span>
			</p>
			<p>
				<strong>Shipping Address:</strong> <span
					th:text="${order.shippingAddress}"></span>
			</p>
			<p>
				<strong>Status:</strong> <span th:text="${order.orderStatus}" style="color: blue; "></span>
			</p>
			<p th:if="${order.deliveryDate}">
				<strong>Delivery Date:</strong> <span
					th:text="${order.deliveryDate}"></span>
			</p>
		</div>
		<div th:if="${voucher}">
			<h2>Voucher</h2>
			<p>
				<strong>Voucher value:</strong> <span th:text="${voucher.voucherValue} + 'đ'"></span>
			</p>
		</div>
		<div>
			<h2>Payment infomation</h2>
			<p>
				<strong>Payment method:</strong> <span th:text="${payment.paymentMethod}"></span>
			</p>
			<p>
				<strong>Total:</strong> <span
					th:text="${payment.total}"></span>
			</p>
		</div>

		<!-- Danh sách sản phẩm trong đơn hàng -->
		<div>
			<h2>Order Items</h2>
			<table border="1">
				<thead>
					<tr>
						<th>Product Image</th>
						<th>Product Name</th>
						<th>Category</th>
						<th>Brand</th>
						<th>Cost</th>
						<th>Quantity</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="orderLine : ${order.orderLines}">
						<td><a th:href="'/product/'+${orderLine.product.productId}"><img th:src="@{${orderLine.product.image}}"
							alt="Product Image"
							style="width: 100px; height: 100px; object-fit: cover;"></a></td>
						<td th:text="${orderLine.product.productName}"></td>
						<td th:text="${orderLine.product.category}"></td>
						<td th:text="${orderLine.product.brand}"></td>
						<td th:text="${orderLine.product.cost}"></td>
						<td th:text="${orderLine.quantity}"></td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<div th:if="${list != null}">
			<h2>Đánh giá</h2>
			<table>
			<thead>
			<tr>
			<td>Product name</td>
			<td>Rating</td>
			<td>Comment</td>
			<td>Review Date</td>
			</tr>
			</thead>
			<tbody>
			<tr th:each="review : ${list}">
			<td th:text="${review.product.productName}"></td>
			<td th:text="${review.rating}"></td>
			<td th:text="${review.comment}"></td>
			<td th:text="${review.feedbackDate}"></td>
			</tr>
			</tbody>
			</table>
		</div>
		
		<div th:if="${order.orderStatus.name() == 'COMPLETED'}">
				<h2>Đánh Giá Sản Phẩm</h2>
				<form action="/review" method="post">
					<input type="text" name= "orderId" th:value="${order.orderId}" hidden="hidden">
					<div class="form-group" style="width: 400px">
						<label>Sản phẩm đánh giá</label>
						<select id="productId" name="productId">
							<option th:each="orderLine : ${order.orderLines}"
								th:value="${orderLine.product.productId}"
								th:text="${orderLine.product.productName}"></option>
						</select>
					</div>

					<div class="form-group">
						<label for="rating">Đánh giá bằng sao:</label>
						<div class="rating">
							<label>1</label>
							<input type="radio" name="rating" id="star5" value="1"> 
							<input type="radio" name="rating" id="star4" value="2">
							<input type="radio" name="rating" id="star3" value="3">
							<input type="radio" name="rating" id="star2" value="4"> 
							<input type="radio" name="rating" id="star1" value="5">
							<label>5</label>
						</div>
					</div>

					<div class="form-group">
						<label for="review">Lời đánh giá:</label>
						<textarea id="comment" name="comment"
							placeholder="Nhập lời đánh giá của bạn..."></textarea>
					</div>
					<button type="submit" class="submit-btn">Gửi đánh giá</button>
				</form>
			</div>
			
		
	</div>
	<div>
<!--		button thanh toán, chỉ hiện khi orderstatus is pending-->
	<div th:if = "${order.orderStatus.toString() == 'PENDING'}">
		<button class="submit-btn" type="button" onclick="pay()" th:data-order-id="${order.orderId}"  th:data-order-status="${order.orderStatus.name()}">Thanh toán lại</button>
	</div>
	<div th:if = "${order.orderStatus.toString() == 'SHIPPING'}">
		<button class="submit-btn" type="button" onclick="complete()" th:data-order-id="${order.orderId}"  >Đã nhận hàng</button>
	</div>
<!--		<button th:if="${order.orderStatus == 'PENDING'}" class="submit-btn" type="button" onclick="pay()" th:data-order-id="${order.orderId}"  th:data-order-status="${order.orderStatus.name()}">Thanh toán</button>-->
	<button class="submit-btn" type="button" onclick="cancelOrder()" th:data-order-id="${order.orderId}" th:data-order-status="${order.orderStatus.name()}">Hủy đơn hàng</button>
	</div>
	<div th:if="${Err != null}" class = "Error">
		<strong th:text="${Err}"></strong>
	</div>
	<footer th:replace="~{customer/fragments/footer::footer}"></footer>

	<script>
		function cancelOrder() {
			// Lấy giá trị orderId từ thuộc tính data của nút
			const orderId = document.querySelector(
					'button[onclick="cancelOrder()"]').getAttribute(
					'data-order-id');

			const orderstatus = document.querySelector(
			'button[onclick="cancelOrder()"]').getAttribute(
			'data-order-status');
			
			 if (orderstatus !== "PENDING" && orderstatus !== "CONFIRMED") {
			        alert('Đơn hàng không đủ điều kiện để hủy.');
			        return; // Dừng hàm nếu điều kiện không đúng
			    }
			
			
			const userConfirmed = confirm('Bạn có chắc chắn muốn hủy đơn hàng này?');

			
			if (userConfirmed) {
				
				window.location.href = '/cancelOrder/' + orderId;
			}
		}

		function pay(){
			const orderId = document.querySelector(
					'button[onclick="pay()"]').getAttribute(
					'data-order-id');
			const orderstatus = document.querySelector(
					'button[onclick="pay()"]').getAttribute(
					'data-order-status');
			if (orderstatus !== "PENDING") {
		        alert('Đơn hàng không đủ điều kiện để thanh toán.');
		        return; // Dừng hàm nếu điều kiện không đúng
		    }
			window.location.href = '/order/reprocessPayment/' + orderId;
		}
		
		function complete(){
			const orderId = document.querySelector(
			'button[onclick="complete()"]').getAttribute(
			'data-order-id');
			window.location.href = '/order/complete/' + orderId;
		}
	</script>
</body>
</html>
